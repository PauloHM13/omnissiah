<!doctype html>
<html lang="pt-br"><head><meta charset="utf-8"><title>Usuários</title></head>
<body>
<h1>Usuários</h1>
<p><a href="{{ url_for('admin_users.new_user') }}">+ Novo usuário</a> | <a href="{{ url_for('auth.dashboard') }}">Voltar</a></p>


{% with msgs = get_flashed_messages(with_categories=true) %}
{% if msgs %}
<ul>{% for cat,msg in msgs %}<li style="color: {{ 'green' if cat=='ok' else 'red' }}">{{ msg }}</li>{% endfor %}</ul>
{% endif %}
{% endwith %}


<table border="1" cellpadding="6" cellspacing="0">
<tr>
<th>ID</th><th>Usuário</th><th>E-mail</th><th>Papel</th><th>Ativo?</th><th>Must change?</th><th>Criado em</th><th>Ações</th>
</tr>
{% for u in users %}
<tr>
<td>{{ u.id }}</td>
<td>{{ u.username }}</td>
<td>{{ u.email }}</td>
<td>{{ u.role }}</td>
<td>{{ 'Sim' if u.is_active else 'Não' }}</td>
<td>{{ 'Sim' if u.must_change_password else 'Não' }}</td>
<td>{{ u.created_at }}</td>
<td>
<form method="post" action="{{ url_for('admin_users.reset_user', user_id=u.id) }}" style="display:inline" onsubmit="return confirm('Gerar nova senha provisória para {{u.username}}?')">
<button type="submit">Resetar senha</button>
</form>
<a href="{{ url_for('admin_users.edit_user', user_id=u.id) }}">Editar</a>
<form method="post" action="{{ url_for('admin_users.delete_user', user_id=u.id) }}" style="display:inline" onsubmit="return confirm('Excluir usuário {{u.username}}?')">
<button type="submit">Excluir</button>
</form>
</td>
</tr>
{% endfor %}
</table>
</body></html>