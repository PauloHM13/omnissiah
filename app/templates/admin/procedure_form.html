{% extends "base.html" %}
{% block title %}{{ 'Novo' if mode=='new' else 'Editar' }} procedimento · MedOptic{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h4 mb-0">{{ 'Novo procedimento' if mode=='new' else 'Editar procedimento' }}</h1>
  <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('admin_procedures.list_procedures') }}">Voltar</a>
</div>

{% if error %}
  <div class="alert alert-danger">{{ error }}</div>
{% endif %}
{% if msg %}
  <div class="alert alert-success">{{ msg }}</div>
{% endif %}

<form method="post" class="card shadow-sm">
  <div class="card-body">
    <div class="row g-3">
      <div class="col-12 col-md-4">
        <label class="form-label">Código</label>
        <input name="tuss_code" class="form-control" placeholder="Digite o código">
               placeholder="Ex.: 20103012"
               value="{{ procedure.tuss_code if procedure else '' }}">
      </div>

      <div class="col-12 col-md-8">
        <label class="form-label">Nome do procedimento</label>
        <input name="name" class="form-control"
               placeholder="Digite o nome"
               value="{{ procedure.name if procedure else '' }}" required>
      </div>

      <div class="col-12 col-md-6">
        <label class="form-label">Unidade de cobrança</label>
        <select name="charge_unit" class="form-select" required>
            <option value="">-- selecione --</option>
            <option value="unit"    {{ 'selected' if procedure and procedure.charge_unit=='unit' else '' }}>Procedimento (unit)</option>
            <option value="hour"    {{ 'selected' if procedure and procedure.charge_unit=='hour' else '' }}>Hora (hour)</option>
            <option value="day"     {{ 'selected' if procedure and procedure.charge_unit=='day' else '' }}>Diária (day)</option>
            <option value="package" {{ 'selected' if procedure and procedure.charge_unit=='package' else '' }}>Pacote (package)</option>
        </select>
        <div class="form-text">Usamos códigos fixos exigidos pelo banco: unit, hour, day, package.</div>
      </div>

      <div class="col-12 col-md-3">
        <label class="form-label">Código interno (opcional)</label>
        <input name="internal_code" class="form-control"
               value="{{ procedure.internal_code if procedure else '' }}">
      </div>

      <div class="col-12 col-md-3">
        <label class="form-label">Grupo (opcional)</label>
        <input name="grp" class="form-control"
               placeholder="Ex.: Oftalmo"
               value="{{ procedure.grp if procedure else '' }}">
      </div>

      <!-- >>> NOVO CAMPO: Valor SUS (Referência) <<< -->
      <div class="col-12 col-md-3">
        <label class="form-label">Valor SUS (referência)</label>
        <input name="valor_sus" class="form-control"
               placeholder="Ex.: 123,45"
               value="{{ procedure.valor_sus if procedure and procedure.valor_sus is not none else '' }}">
        <div class="form-text">Opcional; apenas referência. Use vírgula ou ponto.</div>
      </div>

      {% if mode == 'edit' %}
      <div class="col-12 col-md-3 d-flex align-items-end">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="activeSwitch"
                 name="active" {{ 'checked' if (procedure and procedure.active) else '' }}>
          <label class="form-check-label" for="activeSwitch">Ativo</label>
        </div>
      </div>
      {% endif %}
    </div>
  </div>

  <div class="card-footer d-flex gap-2">
    <button class="btn btn-primary" type="submit">
      {{ 'Criar procedimento' if mode=='new' else 'Salvar alterações' }}
    </button>
    <a class="btn btn-outline-secondary" href="{{ url_for('admin_procedures.list_procedures') }}">Cancelar</a>
  </div>
</form>
{% endblock %}
